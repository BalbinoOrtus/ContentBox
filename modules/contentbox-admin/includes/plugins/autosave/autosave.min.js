/*! ContentBox Modular CMS. Generated: 10-05-2016 */


autoSave=function(editor,pageID,ddMenuID,options){if(!Modernizr.localstorage)return $("#"+ddMenuID).find(".autoSaveBtn").html("Auto Save Unavailable").addClass("disabled"),!1;var defaults={storeMax:10,timeout:4e3},opts=$.extend({},defaults,options||{}),editorID=editor.attr("id"),saveStoreKey=(getContentEditor(),"autosave_"+window.location+"_"+editorID),timer=0,savingActive=!1;localStorage.getItem(saveStoreKey)||localStorage.setItem(saveStoreKey,"[]");var saveStore=JSON.parse(localStorage.getItem(saveStoreKey)),removeOldSaves=function(callback){for(var overMax=saveStore.length-opts.storeMax,i=0;overMax>i;i++)localStorage.removeItem(saveStore[i]),saveStore.splice(i,1);callback&&callback()},addToStore=function(saveKey){saveStore.push(saveKey),saveStore.length>opts.storeMax?removeOldSaves(updateAutoSaveMenu):updateAutoSaveMenu()},updateAutoSaveMenu=function(){localStorage.setItem(saveStoreKey,JSON.stringify(saveStore));for(var ulList="",i=saveStore.length;i--;){var newItemDate=moment(saveStore[i].replace(editorID+"_",""),"x"),dateTitle=moment().diff(newItemDate,"hours")<1?newItemDate.fromNow():newItemDate.format("MM/DD/YYYY h:mm a");ulList+='<li><a href="javascript:void(0)" data-id="'+saveStore[i]+'">'+dateTitle+"</a></li>"}saveStore.length||(ulList='<li><a href="javascript:void(0)">No Autosaves, type something :)</a></li>'),$("#"+ddMenuID).find(".autoSaveMenu").html(ulList)},startTimer=function(event){timer&&clearTimeout(timer),timer=setTimeout(onTimer,opts.timeout,event)},onTimer=function(event){if(savingActive)startTimer(event);else{savingActive=!0;var autoSaveKey=editorID+"_"+Date.now();localStorage.setItem(autoSaveKey,LZString.compressToUTF16(getEditorContent())),addToStore(autoSaveKey),savingActive=!1}},loadContent=function(contentID){var content=localStorage.getItem(contentID);setEditorContent("content",LZString.decompressFromUTF16(content)),timer&&clearTimeout(timer)};getContentEditor().on("change",startTimer),$("#"+ddMenuID).on("click","li > a",function(evt){loadContent($(evt.currentTarget).data("id"))}),updateAutoSaveMenu()};
//# sourceMappingURL=autosave.min.js.map